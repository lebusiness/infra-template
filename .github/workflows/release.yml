name: release
run-name: ${{ github.actor }} is releasing ðŸš€
on: 
  push:
    tags:
      - "rc-*"

jobs:
  release:
    runs-on: ubuntu-latest
    env: 
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
      OAUTH_TOKEN: ${{ secrets.OAUTH_TOKEN }} 
      ORG_ID: ${{ secrets.ORG_ID }}
      tag_name: ${{ github.ref }}
    strategy:
      matrix:
        node-version: [16.16.0]
    steps:
      - name: checkout
        uses: actions/checkout@v3

      - name: setup-node
        uses: actions/setup-node@v3

      - name: tests  
        run: npm ci
        run: npm test
        run: npm run ts
        run: npm run lint

      - name: create release
        uses: actions/create-release@v1
        with:
          tag_name: ${{ github.ref }}
          release_name: Release ${{ github.ref }}
          draft: false
          prerelease: false

      - name: post release  
        run: node postRelease.js

      - name: create docker instanse  
        run: npm run build
        run: docker build . --file Dockerfile --tag ${{github.ref_name}}